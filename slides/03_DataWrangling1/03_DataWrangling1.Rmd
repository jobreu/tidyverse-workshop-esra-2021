---
title: "Introduction to Survey Data Cleaning Using Tidyverse in R"
subtitle: "Data Wrangling - Part 1"
author: "Johannes Breuer<br />Stefan JÃ¼nger"
date: "2021-07-22"
location: "ESRA 2021"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: ["default", "default-fonts", "workshop.css"]
    nature:
      highlightStyle: "github"
      highlightLines: true
      countIncrementalSlides: false
---
layout: true

```{r setup, include = F}
if (!require(easypackages)) install.packages("easypackages")
library(easypackages)

packages("knitr",
         "rmarkdown",
         "tidyverse",
         "gadenbuie/xaringanExtra",
         "gadenbuie/tweetrmd",
         "hadley/emo",
         "sctyner/memer",
         prompt = F)

options(htmltools.dir.version = FALSE,
        htmltools.preserve.raw = FALSE)

opts_chunk$set(echo = TRUE,
               fig.align = "center")

xaringanExtra::use_xaringan_extra(c("tile_view", "clipboard"))
xaringanExtra::use_extra_styles(hover_code_line = TRUE,
                                mute_unhighlighted_code = FALSE)
```

<div class="my-footer">
  <div style="float: left;"><span>`r gsub("<br />", ", ", gsub("<br /><br />|<a.+$", "", metadata$author))`</span></div>
  <div style="float: right;"><span>`r metadata$location`, `r metadata$date`</span></div>
  <div style="text-align: center;"><span>`r gsub(".+<br />", " ", metadata$subtitle)`</span></div>
</div>

---

## Data wrangling `r ji("cowboy_hat_face")`

```{r, wrangling-cartoon, out.width = "95%", echo = F}
include_graphics("./pics/data_cowboy.png")
```
<small><small>Artwork by [Allison Horst](https://github.com/allisonhorst/stats-illustrations) </small></small>

---

## What is data wrangling?

Data wrangling is the process of "getting the data into shape", so that you can then explore and analyze them.

Common data wrangling steps when working with survey data include:
- **renaming** variables
- **recoding** variables/values
- **creating/computing** new variables
- **selecting** a subset of variables
- **filtering** a subset of cases

--

The (in)famous **80/20-rule**: 80% wrangling, 20% analysis<sup>1</sup> 

.footnote[
[1] Of course, this ratio relates to the time the working time of the analyst, not computing time.
]

---

# Data wrangling

Simply put, data wrangling means...

```{r, eval = F}
wrangled_data <- original_data %>% 
  do_something()
```

This is where the *verbs* from the `dplyr` package come in.

```{r dplyr hex, echo = F, out.width = "25%"}
include_graphics("./pics/dplyr.png")
```

---

# Load the data

Before we can wrangle the data, we need to load it. We will work with the `csv` version of the data. To better understand what we are doing, it is helpful to consult the [codebook](https://dbk.gesis.org/dbksearch/download.asp?id=67378) for the original data that this synthetic data set is based on. For understanding the naming scheme for the variables it also helps to have a look at the [*GESIS Panel* cheatsheet](https://www.gesis.org/fileadmin/upload/forschung/programme_projekte/Drittmittelprojekte/GESIS_Panel/gesis_panel_cheatsheet.pdf).

.small[
```{r load data}
gpc <- read_csv("../../data/ZA5667_v1-0-0_Stata14_synthetic-data.csv")
```
]

**NB**: This command uses a relative path that assumes that the working directory is the folder containing these slides. In the course repository/folder, the data set is two levels up (`../../`) from the folder containing these slides in the `data` folder.

---

# Renaming variables

As the variable names are not self-explanatory, we might want to change them. We will use `r ji("snake")` *snake_case*<sup>1</sup> in our examples.

```{r rename}
gpc <- gpc %>% 
  rename(corona_inf_facebook = hzcy090a, # new_name = old_name
         corona_inf_other_sm = hzcy091a)
```

*Note*: The [`janitor` package](https://github.com/sfirke/janitor) (which is `tidyverse`-oriented) can be used to facilitate several common data cleaning tasks, including renaming variables.


.footnote[
[1] For a good introduction to naming schemes that avoid spaces, you can check out the [Medium post by Patrick Divine](https://medium.com/@pddivine/string-case-styles-camel-pascal-snake-and-kebab-case-981407998841).
]